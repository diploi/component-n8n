diploiVersion: v1.0
type: component
name: n8n
description: Official Diploi component for n8n

contexts:
  - name: app
    identifier: app

hosts:
  - name: n8n
    identifier: app
    urlFormat: '[label].[default-domain]'

parameterGroups:
  - name: Connection
    identifier: postgres
    description: Superuser & connection configuration
    parameters:
      - name: DB_POSTGRESDB_DATABASE
        identifier: DB_POSTGRESDB_DATABASE
        defaultValue: postgres
        type: string
      - name: N8N_HOST
        identifier: N8N_HOST
        defaultValue: http://app.${DIPLOI_NAMESPACE}
        type: string
        readOnly: true
      - name: N8N_PORT
        identifier: N8N_PORT
        defaultValue: 5678
        type: string
        readOnly: true

environmentVariables:
  - identifier: DB_TYPE
    defaultValue: postgresdb
  - identifier: DB_POSTGRESDB_SCHEMA
    defaultValue: public

connectionStrings:
  - name: Internal Address
    value: http://app.${DIPLOI_NAMESPACE}:5678
    description: This address is for requests from within the deployment and is inaccessible externally.

images:
  - identifier: app
    prebuildImage: ghcr.io/diploi/component-n8n:[tag]

logs:
  - name: n8n Log
    type: log
    labelSelector: app=app

dependencies:
  - identifier: postgres
    package: https://github.com/diploi/addon-postgres#v17.2
    env:
      include:
        - POSTGRES_HOST:DB_POSTGRESDB_HOST
        - POSTGRES_PORT:DB_POSTGRESDB_PORT
        - POSTGRES_USER:DB_POSTGRESDB_USER
        - POSTGRES_PASSWORD:DB_POSTGRESDB_PASSWORD